package Telefonserver;

import java.util.ArrayList;
import java.util.Scanner;

public class Main {

	private static Telefonbuch telbuch = new Telefonbuch();

	public static void main(String[] args) throws Exception {

		while (true) {
			ArrayList<Integer> nummer = new ArrayList<Integer>();
			String name = "";

			System.out
					.println("\n\n##############################################");
			System.out
					.println("Telefonserver gestartet \nNamen oder Nummer oder Namen und Nummer eingeben, startet die Suche.");
			System.out.println("EXIT beendet das Program. \n");

			// Eingabe mit java.util.Scanner einlesen
			Scanner sc = new Scanner(System.in);
			String[] eingabe = sc.nextLine().trim().split(" ");

			// überprüft auf eine leere Eingabe
			if (eingabe.length == 0 || eingabe[0].equals("")) {
				System.out.println("Leere Eingaben sind Ungültig!");
				continue;
			}

			// überprüft auf 'exit'
			if (eingabe[0].equals("EXIT")) {
				System.out.println("Programm wurde beendet");
				System.exit(0);
			}

			// Schleife untersucht String Array
			for (int i = 0; i < eingabe.length; i++) {
				if (eingabe[i].matches("\\d*")) {
					nummer.add(Integer.parseInt(eingabe[i]));
				} else if (eingabe[i].matches("\\D*")) {
					name += eingabe[i].trim() + " ";
				} else {
					System.out.println(" Eingabe ungültig!");
				}
			}

			// wenn eine Nummer und ein Name eingegeben wird,
			// dann werden zwei Nebenläufige Threads gestartet.
			if (!name.equals("") && nummer.size() != 0) {
				Thread thread1 = telbuch.new SuchThread(name.trim());
				Thread thread2 = telbuch.new SuchThread(nummer.get(0));
				thread1.start();
				thread2.start();
				thread1.join();
				thread2.join();
			} else {
				// wurde nur eine nummer gesucht dann startet die suche in einem
				// neuen thread
				for (int i = 0; i < nummer.size(); i++) {
					Thread thread = telbuch.new SuchThread(nummer.get(i));
					thread.start();
					thread.join();
				}
				// wurde nur ein name gesucht dann startet die suche in einem
				// neuen thread
				if (!name.equals("")) {
					Thread thread = telbuch.new SuchThread(name.trim());
					thread.start();
					thread.join();
				}

				// gibt die Suchergebnisse aus
				for (String e : telbuch.ausgabeName) {
					System.out.println(e);
				}
				telbuch.ausgabeName.clear();

				for (String e : telbuch.ausgabeNummer) {
					System.out.println(e);
				}
				telbuch.ausgabeNummer.clear();
			}

			// debug
			// System.out.println(eingabe[0]);
		}

	}

}
